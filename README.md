# Checkout Experience templates
[![pipeline status](https://git-lab.boldapps.net/bold-checkout/checkout-experience-templates/badges/main/pipeline.svg)](https://git-lab.boldapps.net/bold-checkout/checkout-experience-templates/-/commits/main)
[![coverage report](https://git-lab.boldapps.net/bold-checkout/checkout-experience-templates/badges/main/coverage.svg)](https://git-lab.boldapps.net/bold-checkout/checkout-experience-templates/-/commits/main)

## Contents

* [Description](#description)
* [Installation](#installation)
  * [Helper Script](#helper-script)
  * [Manual](#manual)
* [Usage](#usage)

---

## Description
This example is to provide code base to generate the Javascript to load Checkout using Bold Checkout Storefront APIs.

It is made a Typescript project **Checkout Experience Templates** using a library called **Checkout Frontend library**.

* **Checkout Frontend library** helps to connecting to Bold Checkout Storefront APIs and is not dependent of any particular frontend library such as React or Vue allowing flexibility to re-use it. 
* **Checkout Experience Templates** is a React app that generates different Javascript for each Theme/Template, it utilizes the **Checkout Frontend Library** to communicate with Bold Checkout Storefront APIs.

---

## Installation

For the installation requires **node**, **npm**, **nvm** previously installed.

From the root folder of this project do the follow:

* Access templates folder
```
cd ../templates
```

* Install Checkout Experience Templates node_modules
```
npm install
```

* Build Checkout Experience Templates code
```
npm run build-dev
```
_Use `build-dev` for `development` mode javascript generation_

_Use `build` for `production` mode javascript generation_

* The templates generated can be found in:

`<path_to_project>/templates/build`

---

## Usage

The Javascript templates generated by Checkout Experience Templates have the follow requirements to load correctly:
* The Document in which the script is loaded need to have a `div` element with the ID `main`.
```html
<div id="main"><!-- This div is where the app will run --></div>
```
* It is also required to have access to the [Browser Window Object](https://developer.mozilla.org/en-US/docs/Web/API/Window). 
  * Follow are the `properties` and `methods` from `window` that are used by the templates:
    * [window.location.href](https://developer.mozilla.org/en-US/docs/Web/API/Location/href)
    * [window.location.hostname](https://developer.mozilla.org/en-US/docs/Web/API/Location/hostname)
    * [window.location.pathname](https://developer.mozilla.org/en-US/docs/Web/API/Location/pathname)
    * [window.history.replaceState](https://developer.mozilla.org/en-US/docs/Web/API/History/replaceState)
    * [window.innerWidth](https://developer.mozilla.org/en-US/docs/Web/API/Window/innerWidth)
    * [window.addEventListener](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener)
    * [window.removeEventListener](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/removeEventListener)
    * [window.scrollTo](https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollTo)
    * [window.matchMedia](https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia)

  * The follow `properties` need to be added to the Window Object when the document is created for the script to use when finishing loading:
      * `window.initialTimestamps` :
        * It is an object of type `IFrontEndEvent` or `string` that can be set to send event information to track speed.
          
          _Code Reference: `checkout-experience-templates/src/hooks/useSendEvent.ts`_
      * `window.storeLoadTimesLocally` :
          * It is a `boolean` that enable or not the functionality to send event information to track speed.

            _Code Reference: `checkout-experience-templates/src/hooks/useSendEvent.ts`_
      * `window.environment` :
          * It is an object of type `IEnvironment` that sets the type of environment the app is running in order to call the correct Bold Checkout APIs.
      ```javascript 
        window.environment = {type: 'production'}
      ```
      * `window.bugsnagApiKey` :
          * It is an **optional** `string` used to connect to BugSnag to report error when they happen.
      * `window.customDomain` :
          * It is an **optional** `string` used to as a vanity override for the shopAlias URL to access the shop from the Bold Checkout Page.
      * `window.enableConsole` :
          * It is an **optional** `boolean` used to define is extra `console.error` should be printed for handled errors when they happen.
      * `window.shopIdentifier` :
          * It is a `string` used as the identifier of the shop, which can be retrieved by making a request to the [Get Info](https://developer.boldcommerce.com/default/api/shops#operation/GetShopInfo) endpoint.
      * `window.shopAlias` :
          * It is a `string` used to create the URL to access the shop and to compose the URL to access Bold Checkout Page.
      * `window.shopName` :
          * It is a `string` used as Checkout Title to identify the store to the customer.
      * `window.headerLogoUrl` :
          * It is an **optional** `string` URL of an image used to load a logo on the top of the Checkout along with the Title.
      * `window.returnUrl` :
          * It is a `string` URL to the cart page that it is used on the footer of Checkout to allow customer to return to the cart.
      * `window.loginUrl` :
          * It is a `string` URL to redirect the customer to the store login page when they click to log in from the Checkout page.
      * `window.supportEmail` :
          * It is a `string` with the email the customer can use to contact the store, it is used to show a `mailto` link on the footer and thank you page of the Checkout.
      * `window.platformType` :
          * It is a `string` that defines the platform and is used to compose the URL to load or redirect the Checkout.
      * `window.publicOrderId` :
          * It is a `string` that contains the public order id generated when the order is initialized by making a request to the [Initialize Order](https://developer.boldcommerce.com/default/api/orders#operation/post-init) endpoint.
      * `window.initializedOrder` :
          * It is an Object that contains the JSON response of when the order is initialized by making a request to the [Initialize Order](https://developer.boldcommerce.com/default/api/orders#operation/post-init) endpoint.

            
        _The JSON response can be also merged with the response from the [Add Authenticated Customer](https://developer.boldcommerce.com/default/api/orders#tag/Customers/operation/post-auth-customers) endpoint to allow initializing Checkout with already logged user_
